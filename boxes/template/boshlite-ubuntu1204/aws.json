{
  "variables": {
    "base_ami": "ami-69f5a900"
  },

  "builders": [
    {
      "type": "amazon-ebs",
      "ami_name": "boshlite-{{timestamp}}",
      "instance_type": "m1.large",
      "region": "us-east-1",
      "source_ami":  "{{user `base_ami`}}",
      "ssh_username": "ubuntu",
      "ami_block_device_mappings": [
          {"device_name": "/dev/sda1", "volume_size": 40}
      ],
      "ami_description": "Bosh-lite AMI" }
  ],
  "provisioners": [{
    "type": "shell",
    "scripts": [
      "script/base-aws.sh",
      "script/vagrant.sh"
    ],
    "override": {
      "amazon-ebs": {
        "execute_command": "echo 'packer'|{{.Vars}} sudo -E -S bash '{{.Path}}'"
      }
    }
  },
  {
     "type": "chef-solo",
     "cookbook_paths": ["../../../cookbooks", "../../../site-cookbooks"],
     "run_list": ["bosh-lite::warden", "bosh-lite::bosh", "bosh-lite::bosh_cli", "bosh-lite::aws_files", "bosh-lite::update-kernel"],
     "json": { "boshlite": { "enable_compiled_package_cache": false } }
  },
  {
    "type": "shell",
    "scripts": [
      "script/cleanup.sh"
    ],
    "override": {
      "amazon-ebs": {
        "execute_command": "echo 'packer'|{{.Vars}} sudo -E -S bash '{{.Path}}'"
      }
    }
  }]
 }
